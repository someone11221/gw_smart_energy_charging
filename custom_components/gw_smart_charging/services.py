from __future__ import annotations\nfrom homeassistant.core import HomeAssistant, ServiceCall\n\nfrom .const import DOMAIN\n\n_LOGGER = logging.getLogger(__name__)\n\nasync def async_setup_services(hass: HomeAssistant):\n    hass.services.async_register(DOMAIN, "optimize_now", _handle_optimize_now)\n    hass.services.async_register(DOMAIN, "apply_schedule_now", _handle_apply_schedule_now)\n\nasync def _handle_optimize_now(call: ServiceCall):\n    hass = call.hass\n    for entry_id, coord in hass.data.get(DOMAIN, {}).items():\n        await coord.async_request_refresh()\n\nasync def _handle_apply_schedule_now(call: ServiceCall):\n    hass = call.hass\n    for entry_id, coord in hass.data.get(DOMAIN, {}).items():\n        await coord.apply_current_hour()