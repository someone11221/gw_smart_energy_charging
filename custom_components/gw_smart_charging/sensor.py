from __future__ import annotations\nfrom homeassistant.components.sensor import SensorEntity\nfrom homeassistant.helpers.update_coordinator import CoordinatorEntity\nfrom homeassistant.config_entries import ConfigEntry\nfrom homeassistant.core import HomeAssistant\n\nfrom .const import DOMAIN, DEFAULT_NAME, ATTR_FORECAST\n\nasync def async_setup_entry(hass: HomeAssistant, entry: ConfigEntry, async_add_entities):\n    coordinator = hass.data[DOMAIN][entry.entry_id]\n    async_add_entities([ForecastNextDaySensor(coordinator, entry)], True)\n\nclass ForecastNextDaySensor(CoordinatorEntity, SensorEntity):\n    def __init__(self, coordinator, entry):\n        super().__init__(coordinator)\n        self.coordinator = coordinator\n        self.entry = entry\n        self._attr_name = entry.data.get("name", DEFAULT_NAME)\n        self._attr_unique_id = f"gw_smart_charging_{entry.entry_id}"\n\n    @property\n    def native_value(self):\n        schedule = self.coordinator.schedule or {}\n        grid_hours = sum(1 for v in schedule.values() if v.get("mode") == "grid")\n        pv_hours = sum(1 for v in schedule.values() if v.get("mode") == "pv")\n        return f"grid:{grid_hours} pv:{pv_hours}"\n\n    @property\n    def extra_state_attributes(self):\n        data = self.coordinator.data or {}\n        return {\n            ATTR_FORECAST: data.get("schedule", self.coordinator.schedule),\n            "prices": data.get("prices"),\n            "forecast_series": data.get("forecast"),\n            "last_update": data.get("timestamp"),\n            "current_soc": data.get("current_soc"),\n            "goodwe_switch": data.get("goodwe_switch"),\n        }\n\n    async def async_update(self):\n        await self.coordinator.async_request_refresh()\n