# Example Lovelace Cards for GW Smart Charging v1.7.0
# =====================================================
# Kompletn√≠ dashboard s funkƒçn√≠mi ApexCharts a nov√Ωmi senzory

# KOMPLETN√ç DASHBOARD VIEW
# -------------------------
title: GW Smart Charging
path: gw-charging
icon: mdi:battery-charging
badges: []
cards:
  # Status Card - Aktu√°ln√≠ stav a predikce
  - type: entities
    title: "üìä GW Smart Charging - Status & Predikce"
    show_header_toggle: false
    entities:
      - entity: sensor.gw_smart_charging_diagnostics
        name: Status integrace
        icon: mdi:information
      - entity: sensor.gw_smart_charging_prediction
        name: Kvalita predikce
        icon: mdi:crystal-ball
      - type: divider
      - entity: sensor.gw_smart_charging_schedule
        name: Aktu√°ln√≠ re≈æim
        icon: mdi:cog
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: should_charge_now
        name: Mƒõlo by nab√≠jet
        icon: mdi:battery-charging
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: current_price
        name: Aktu√°ln√≠ cena
        suffix: " CZK/kWh"
        icon: mdi:currency-czk
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: current_soc
        name: Aktu√°ln√≠ SOC
        suffix: " %"
        icon: mdi:battery
      - type: divider
      - entity: switch.gw_smart_charging_auto_charging
        name: Automatick√© nab√≠jen√≠
      - entity: sensor.gw_smart_charging_next_grid_charge
        name: P≈ô√≠≈°t√≠ nab√≠jen√≠
        icon: mdi:clock-start
      - entity: sensor.gw_smart_charging_next_battery_discharge
        name: P≈ô√≠≈°t√≠ vyb√≠jen√≠
        icon: mdi:battery-arrow-down

  # Denn√≠ statistiky a √∫spory
  - type: entities
    title: "üí∞ Denn√≠ statistiky a √∫spory"
    show_header_toggle: false
    entities:
      - entity: sensor.gw_smart_charging_daily_statistics
        name: Pl√°novan√© nab√≠jen√≠ ze s√≠tƒõ
        icon: mdi:lightning-bolt
      - type: attribute
        entity: sensor.gw_smart_charging_daily_statistics
        attribute: planned_solar_charge_kwh
        name: Pl√°novan√© nab√≠jen√≠ ze sol√°r≈Ø
        suffix: " kWh"
        icon: mdi:solar-power
      - type: attribute
        entity: sensor.gw_smart_charging_daily_statistics
        attribute: planned_battery_discharge_kwh
        name: Pl√°novan√© vyb√≠jen√≠ baterie
        suffix: " kWh"
        icon: mdi:battery-arrow-down
      - type: attribute
        entity: sensor.gw_smart_charging_daily_statistics
        attribute: estimated_grid_cost_czk
        name: Odhadovan√© n√°klady
        suffix: " Kƒç"
        icon: mdi:currency-czk
      - type: attribute
        entity: sensor.gw_smart_charging_daily_statistics
        attribute: savings_vs_flat_rate
        name: √öspora oproti paus√°lu
        suffix: " Kƒç"
        icon: mdi:piggy-bank
      - type: divider
      - type: attribute
        entity: sensor.gw_smart_charging_daily_statistics
        attribute: actual_today_charge_kwh
        name: Skuteƒçn√© nabit√≠ dnes
        suffix: " kWh"
        icon: mdi:battery-plus
      - type: attribute
        entity: sensor.gw_smart_charging_daily_statistics
        attribute: actual_today_discharge_kwh
        name: Skuteƒçn√© vybit√≠ dnes
        suffix: " kWh"
        icon: mdi:battery-minus
      - type: attribute
        entity: sensor.gw_smart_charging_daily_statistics
        attribute: charge_efficiency_pct
        name: Efektivita nab√≠jen√≠
        suffix: " %"
        icon: mdi:percent

  # ApexCharts - 24h pl√°n nab√≠jen√≠ s SOC
  - type: custom:apexcharts-card
    header:
      show: true
      title: "üìà Pl√°n nab√≠jen√≠ a SOC - 24 hodin"
      show_states: true
      colorize_states: true
    graph_span: 24h
    span:
      start: day
    now:
      show: true
      label: Nyn√≠
      color: red
    yaxis:
      - id: power
        decimals: 1
        min: 0
        apex_config:
          title:
            text: V√Ωkon (kW)
          labels:
            formatter: |
              EVAL:function(value) {
                return value ? value.toFixed(1) + ' kW' : '0 kW';
              }
      - id: soc
        opposite: true
        decimals: 0
        min: 0
        max: 100
        apex_config:
          title:
            text: SOC (%)
          labels:
            formatter: |
              EVAL:function(value) {
                return value ? value.toFixed(0) + '%' : '0%';
              }
    apex_config:
      chart:
        height: 400px
      legend:
        show: true
        position: bottom
      tooltip:
        enabled: true
        shared: true
        x:
          format: 'HH:mm'
    series:
      - entity: sensor.gw_smart_charging_series_pv
        name: Sol√°rn√≠ v√Ωroba
        type: area
        color: orange
        opacity: 0.3
        yaxis_id: power
        data_generator: |
          return entity.attributes.data_15min?.map((value, index) => {
            const timestamp = entity.attributes.timestamps?.[index];
            return timestamp ? [new Date(timestamp).getTime(), value || 0] : null;
          }).filter(item => item !== null) || [];
      
      - entity: sensor.gw_smart_charging_series_load
        name: Spot≈ôeba domu
        type: line
        color: blue
        stroke_width: 2
        yaxis_id: power
        data_generator: |
          return entity.attributes.data_15min?.map((value, index) => {
            const timestamp = entity.attributes.timestamps?.[index];
            return timestamp ? [new Date(timestamp).getTime(), value || 0] : null;
          }).filter(item => item !== null) || [];
      
      - entity: sensor.gw_smart_charging_series_battery_charge
        name: Nab√≠jen√≠ baterie
        type: column
        color: green
        yaxis_id: power
        data_generator: |
          return entity.attributes.data_15min?.map((value, index) => {
            const timestamp = entity.attributes.timestamps?.[index];
            return timestamp ? [new Date(timestamp).getTime(), value || 0] : null;
          }).filter(item => item !== null) || [];
      
      - entity: sensor.gw_smart_charging_series_battery_discharge
        name: Vyb√≠jen√≠ baterie
        type: column
        color: red
        yaxis_id: power
        data_generator: |
          return entity.attributes.data_15min?.map((value, index) => {
            const timestamp = entity.attributes.timestamps?.[index];
            return timestamp ? [new Date(timestamp).getTime(), value || 0] : null;
          }).filter(item => item !== null) || [];
      
      - entity: sensor.gw_smart_charging_series_soc_forecast
        name: SOC progn√≥za
        type: line
        color: purple
        stroke_width: 3
        curve: smooth
        yaxis_id: soc
        data_generator: |
          return entity.attributes.data_15min?.map((value, index) => {
            const timestamp = entity.attributes.timestamps?.[index];
            return timestamp ? [new Date(timestamp).getTime(), value || 0] : null;
          }).filter(item => item !== null) || [];

  # Ceny elekt≈ôiny s prahy a pl√°novan√Ωm nab√≠jen√≠m
  - type: custom:apexcharts-card
    header:
      show: true
      title: "üí∞ Ceny elekt≈ôiny a nab√≠jen√≠ - 24 hodin"
    graph_span: 24h
    span:
      start: day
    now:
      show: true
      label: Nyn√≠
    yaxis:
      - id: price
        decimals: 2
        apex_config:
          title:
            text: Cena (CZK/kWh)
          labels:
            formatter: |
              EVAL:function(value) {
                return value ? value.toFixed(2) + ' Kƒç' : '0 Kƒç';
              }
    apex_config:
      chart:
        height: 300px
      annotations:
        yaxis:
          - y: 1.5
            borderColor: '#00C851'
            strokeDashArray: 5
            label:
              text: 'Always Charge (1.5 CZK)'
              style:
                background: '#00C851'
                color: '#fff'
          - y: 4.0
            borderColor: '#ff4444'
            strokeDashArray: 5
            label:
              text: 'Never Charge (4.0 CZK)'
              style:
                background: '#ff4444'
                color: '#fff'
      tooltip:
        enabled: true
        x:
          format: 'HH:mm'
    series:
      - entity: sensor.gw_smart_charging_price
        name: Cena elekt≈ôiny
        type: line
        color: '#ffbb33'
        stroke_width: 3
        yaxis_id: price
        data_generator: |
          return entity.attributes.price_15min?.map((value, index) => {
            const timestamp = entity.attributes.timestamps?.[index];
            return timestamp ? [new Date(timestamp).getTime(), value || 0] : null;
          }).filter(item => item !== null) || [];

  # Predikce a ML konfidence
  - type: entities
    title: "üîÆ ML Predikce & Konfidence"
    show_header_toggle: false
    entities:
      - entity: sensor.gw_smart_charging_prediction
        name: Status predikce
        icon: mdi:crystal-ball
      - type: attribute
        entity: sensor.gw_smart_charging_prediction
        attribute: prediction_quality_score
        name: Kvalita predikce
        suffix: " %"
        icon: mdi:chart-line
      - type: attribute
        entity: sensor.gw_smart_charging_prediction
        attribute: ml_confidence
        name: ML konfidence
        icon: mdi:brain
      - type: attribute
        entity: sensor.gw_smart_charging_prediction
        attribute: ml_history_days
        name: Historick√Ωch dn≈Ø
        suffix: " dn√≠"
        icon: mdi:calendar
      - type: divider
      - type: attribute
        entity: sensor.gw_smart_charging_prediction
        attribute: forecast_confidence_score
        name: Forecast konfidence
        icon: mdi:weather-sunny
      - type: attribute
        entity: sensor.gw_smart_charging_prediction
        attribute: forecast_confidence_reason
        name: D≈Øvod
        icon: mdi:information
      - type: attribute
        entity: sensor.gw_smart_charging_prediction
        attribute: forecast_data_points
        name: Datov√Ωch bod≈Ø
        icon: mdi:dots-hexagon
      - type: divider
      - type: attribute
        entity: sensor.gw_smart_charging_prediction
        attribute: day_of_week
        name: Den v t√Ωdnu
        icon: mdi:calendar-today
      - type: attribute
        entity: sensor.gw_smart_charging_prediction
        attribute: is_weekend
        name: V√≠kend
        icon: mdi:calendar-weekend

  # Konfigurace a diagnostika
  - type: entities
    title: "‚öôÔ∏è Konfigurace & Diagnostika"
    show_header_toggle: false
    entities:
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: automation_enabled
        name: Automatizace povolena
        icon: mdi:robot
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: charging_on_script
        name: Script ON
        icon: mdi:script-text
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: charging_off_script
        name: Script OFF
        icon: mdi:script-text-outline
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: update_interval_minutes
        name: Update interval
        suffix: " min"
        icon: mdi:update
      - type: divider
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: battery_power_w
        name: Aktu√°ln√≠ v√Ωkon baterie
        suffix: " W"
        icon: mdi:flash
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: battery_status
        name: Status baterie
        icon: mdi:battery
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: grid_import_w
        name: Import ze s√≠tƒõ
        suffix: " W"
        icon: mdi:transmission-tower
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: pv_power_w
        name: V√Ωkon FV
        suffix: " W"
        icon: mdi:solar-power

  # Activity Log - posledn√≠ch 10 aktivit
  - type: entities
    title: "üìù Activity Log - Posledn√≠ aktivity"
    show_header_toggle: false
    entities:
      - entity: sensor.gw_smart_charging_activity_log
        name: Aktu√°ln√≠ aktivita
        icon: mdi:history
      - type: attribute
        entity: sensor.gw_smart_charging_activity_log
        attribute: total_log_entries
        name: Celkem z√°znam≈Ø
        icon: mdi:counter
      - type: divider
      - type: attribute
        entity: sensor.gw_smart_charging_activity_log
        attribute: recent_activity
        name: Posledn√≠ zmƒõny
        icon: mdi:format-list-bulleted

# KOMPAKTN√ç VARIANTA - pro men≈°√≠ displeje
# ----------------------------------------

# Mini Status Card
  - type: entities
    title: "‚ö° Quick Status"
    show_header_toggle: false
    entities:
      - entity: sensor.gw_smart_charging_schedule
      - entity: sensor.gw_smart_charging_next_grid_charge
      - entity: sensor.gw_smart_charging_daily_statistics
      - entity: sensor.gw_smart_charging_prediction
      - entity: switch.gw_smart_charging_auto_charging

# TIPY PRO POU≈ΩIT√ç
# ----------------
# 1. Nainstalujte ApexCharts card: https://github.com/RomRider/apexcharts-card
# 2. Kop√≠rujte sekce kartiƒçek dle pot≈ôeby
# 3. Upravte entity_id pokud se li≈°√≠ od v√Ωchoz√≠ch
# 4. Pro vlastn√≠ prahy upravte y: hodnoty v annotations
# 5. Dashboard je p≈ô√≠stupn√Ω na: /lovelace/gw-charging
