# Example Lovelace Cards for GW Smart Charging v1.4.0
# =====================================================

# Z√ÅKLADN√ç DASHBOARD - Kop√≠rujte p≈ô√≠mo do Lovelace editoru
# ---------------------------------------------------------

# 1. KOMPLETN√ç DASHBOARD VIEW
# ----------------------------
title: GW Smart Charging
path: gw-charging
icon: mdi:battery-charging
badges: []
cards:
  # Status Card - Aktu√°ln√≠ stav
  - type: entities
    title: "üìä GW Smart Charging - Status"
    show_header_toggle: false
    entities:
      - entity: sensor.gw_smart_charging_diagnostics
        name: Status integrace
        icon: mdi:information
      - type: divider
      - entity: sensor.gw_smart_charging_schedule
        name: Aktu√°ln√≠ re≈æim
        icon: mdi:cog
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: should_charge_now
        name: Mƒõlo by nab√≠jet
        icon: mdi:battery-charging
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: current_price
        name: Aktu√°ln√≠ cena
        suffix: " CZK/kWh"
        icon: mdi:currency-czk
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: current_soc
        name: Aktu√°ln√≠ SOC
        suffix: " %"
        icon: mdi:battery
      - type: divider
      - entity: switch.gw_smart_charging_auto_charging
        name: Automatick√© nab√≠jen√≠
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: charging_slots_today
        name: Nab√≠jec√≠ch slot≈Ø dnes
        icon: mdi:clock-outline
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: next_charge_time
        name: Dal≈°√≠ nab√≠jen√≠
        icon: mdi:clock-start
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: last_update
        name: Posledn√≠ update
        icon: mdi:update

  # ApexCharts - 24h pl√°n nab√≠jen√≠
  - type: custom:apexcharts-card
    header:
      show: true
      title: "üìà Pl√°n nab√≠jen√≠ - 24 hodin"
      show_states: true
      colorize_states: true
    graph_span: 24h
    span:
      start: day
    now:
      show: true
      label: Nyn√≠
      color: red
    yaxis:
      - id: power
        decimals: 1
        min: 0
        apex_config:
          title:
            text: V√Ωkon (kW)
          labels:
            formatter: |
              EVAL:function(value) {
                return value.toFixed(1) + ' kW';
              }
      - id: soc
        opposite: true
        decimals: 0
        min: 0
        max: 100
        apex_config:
          title:
            text: SOC (%)
          labels:
            formatter: |
              EVAL:function(value) {
                return value.toFixed(0) + '%';
              }
    apex_config:
      chart:
        height: 400px
      legend:
        show: true
        position: bottom
      tooltip:
        enabled: true
        shared: true
    series:
      - entity: sensor.gw_smart_charging_series_pv
        name: Sol√°rn√≠ v√Ωroba
        type: area
        color: orange
        opacity: 0.3
        yaxis_id: power
        data_generator: |
          return entity.attributes.data_15min.map((value, index) => {
            return [new Date(entity.attributes.timestamps[index]).getTime(), value];
          });
      
      - entity: sensor.gw_smart_charging_series_load
        name: Spot≈ôeba domu
        type: line
        color: blue
        stroke_width: 2
        yaxis_id: power
        data_generator: |
          return entity.attributes.data_15min.map((value, index) => {
            return [new Date(entity.attributes.timestamps[index]).getTime(), value];
          });
      
      - entity: sensor.gw_smart_charging_series_battery_charge
        name: Nab√≠jen√≠ baterie
        type: column
        color: green
        yaxis_id: power
        data_generator: |
          return entity.attributes.data_15min.map((value, index) => {
            return [new Date(entity.attributes.timestamps[index]).getTime(), value];
          });
      
      - entity: sensor.gw_smart_charging_series_battery_discharge
        name: Vyb√≠jen√≠ baterie
        type: column
        color: red
        yaxis_id: power
        data_generator: |
          return entity.attributes.data_15min.map((value, index) => {
            return [new Date(entity.attributes.timestamps[index]).getTime(), value];
          });
      
      - entity: sensor.gw_smart_charging_series_soc_forecast
        name: SOC progn√≥za
        type: line
        color: purple
        stroke_width: 3
        curve: smooth
        yaxis_id: soc
        data_generator: |
          return entity.attributes.data_15min.map((value, index) => {
            return [new Date(entity.attributes.timestamps[index]).getTime(), value];
          });

  # Ceny elekt≈ôiny s prahy
  - type: custom:apexcharts-card
    header:
      show: true
      title: "üí∞ Ceny elekt≈ôiny - 24 hodin"
    graph_span: 24h
    span:
      start: day
    now:
      show: true
      label: Nyn√≠
    yaxis:
      - id: price
        decimals: 2
        apex_config:
          title:
            text: Cena (CZK/kWh)
    apex_config:
      chart:
        height: 250px
      annotations:
        yaxis:
          - y: 1.5
            borderColor: '#00C851'
            strokeDashArray: 5
            label:
              text: 'Always Charge (1.5 CZK)'
              style:
                background: '#00C851'
                color: '#fff'
          - y: 4.0
            borderColor: '#ff4444'
            strokeDashArray: 5
            label:
              text: 'Never Charge (4.0 CZK)'
              style:
                background: '#ff4444'
                color: '#fff'
    series:
      - entity: sensor.gw_smart_charging_price
        name: Cena elekt≈ôiny
        type: line
        color: '#ffbb33'
        stroke_width: 3
        yaxis_id: price
        data_generator: |
          return entity.attributes.price_15min.map((value, index) => {
            return [new Date(entity.attributes.timestamps[index]).getTime(), value];
          });

  # Konfigurace - p≈ôehled
  - type: entities
    title: "‚öôÔ∏è Konfigurace"
    show_header_toggle: false
    entities:
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: automation_enabled
        name: Automatizace povolena
        icon: mdi:robot
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: charging_on_script
        name: Script ON
        icon: mdi:script-text
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: charging_off_script
        name: Script OFF
        icon: mdi:script-text-outline
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: update_interval_minutes
        name: Update interval
        suffix: " min"
        icon: mdi:update
      - type: divider
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: forecast_source
        name: Forecast zdroj
        icon: mdi:weather-sunny
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: forecast_confidence
        name: Forecast confidence
        icon: mdi:chart-line

# 2. KOMPAKTN√ç KARTA - pro hlavn√≠ dashboard
# ------------------------------------------
  - type: vertical-stack
    cards:
      - type: glance
        title: GW Smart Charging
        show_name: true
        show_state: true
        entities:
          - entity: sensor.gw_smart_charging_schedule
            name: Re≈æim
          - entity: sensor.gw_smart_charging_price
            name: Cena
          - entity: sensor.gw_smart_charging_soc_forecast
            name: SOC
          - entity: switch.gw_smart_charging_auto_charging
            name: Auto
      
      - type: horizontal-stack
        cards:
          - type: button
            entity: script.nabijeni_on
            name: Nab√≠jen√≠ ON
            icon: mdi:battery-charging
            tap_action:
              action: call-service
              service: script.turn_on
              service_data:
                entity_id: script.nabijeni_on
          
          - type: button
            entity: script.nabijeni_off
            name: Nab√≠jen√≠ OFF
            icon: mdi:battery-off
            tap_action:
              action: call-service
              service: script.turn_on
              service_data:
                entity_id: script.nabijeni_off

# 3. MOBILE-FRIENDLY KARTA
# -------------------------
  - type: vertical-stack
    cards:
      - type: markdown
        content: |
          ## üîã GW Smart Charging
          
          **Re≈æim:** {{ states('sensor.gw_smart_charging_schedule') }}  
          **Cena:** {{ state_attr('sensor.gw_smart_charging_diagnostics', 'current_price') }} CZK/kWh  
          **SOC:** {{ state_attr('sensor.gw_smart_charging_diagnostics', 'current_soc') }}%  
          **Nab√≠jen√≠:** {% if state_attr('sensor.gw_smart_charging_diagnostics', 'should_charge_now') %}‚úÖ ANO{% else %}‚ùå NE{% endif %}
          
          ---
          
          **Dnes nab√≠jen√≠:** {{ state_attr('sensor.gw_smart_charging_diagnostics', 'charging_slots_today') }} slot≈Ø  
          **Dal≈°√≠:** {{ state_attr('sensor.gw_smart_charging_diagnostics', 'next_charge_time') }}
      
      - type: entities
        entities:
          - entity: switch.gw_smart_charging_auto_charging

# 4. DIAGNOSTICK√Å KARTA - pro troubleshooting
# -------------------------------------------
  - type: entities
    title: "üîç Diagnostika"
    show_header_toggle: false
    state_color: true
    entities:
      - entity: sensor.gw_smart_charging_diagnostics
        name: Diagnostick√Ω senzor
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: last_script_state
        name: Posledn√≠ stav skriptu
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: current_slot
        name: Aktu√°ln√≠ slot
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: total_schedule_slots
        name: Celkem slot≈Ø
      - type: attribute
        entity: sensor.gw_smart_charging_diagnostics
        attribute: mode_distribution
        name: Distribuce re≈æim≈Ø
      - type: divider
      - entity: sensor.gw_smart_charging_forecast_status
        name: Status integrace
      - entity: sensor.gw_smart_charging_forecast
        name: Forecast peak
      - entity: sensor.gw_smart_charging_price
        name: Aktu√°ln√≠ cena
