# Example Scripts for GW Smart Charging v1.4.0
# ==============================================
# Tyto skripty jsou vol√°ny automaticky integrac√≠ ka≈æd√© 2 minuty.
# P≈ôizp≈Øsobte je va≈°√≠ GoodWe konfiguraci.

# D≈ÆLE≈ΩIT√â: Integrace vol√° tyto skripty pomoc√≠ script.turn_on service,
# tak≈æe skripty mus√≠ b√Ωt pojmenovan√© p≈ôesnƒõ jako v konfiguraci integrace.

# 1. Script pro zapnut√≠ nab√≠jen√≠ (nabijeni_on)
# ---------------------------------------------
nabijeni_on:
  alias: "GW - Zapnout nab√≠jen√≠"
  description: "Zapne nab√≠jen√≠ baterie z gridu (vol√° integrace automaticky)"
  icon: mdi:battery-charging
  sequence:
    # Varianta A: Pokud m√°te GoodWe switch p≈ô√≠mo
    - service: switch.turn_on
      target:
        entity_id: switch.goodwe_battery_charge_from_grid
    
    # Varianta B: Pokud ovl√°d√°te p≈ôes ModBus
    # - service: modbus.write_register
    #   data:
    #     hub: goodwe
    #     address: 45352  # Grid charge enable register
    #     value: 1
    
    # Varianta C: Pokud pou≈æ√≠v√°te REST API
    # - service: rest_command.goodwe_enable_charging
    
    # Logov√°n√≠ pro diagnostiku
    - service: logbook.log
      data:
        name: "GW Smart Charging"
        message: "Nab√≠jen√≠ ZAPNUTO - cena: {{ state_attr('sensor.gw_smart_charging_schedule', 'current_price') }} CZK/kWh"
    
    # Volitelnƒõ: Notifikace
    # - service: notify.persistent_notification
    #   data:
    #     title: "‚ö° GW Nab√≠jen√≠"
    #     message: "Nab√≠jen√≠ baterie ZAPNUTO"

# 2. Script pro vypnut√≠ nab√≠jen√≠ (nabijeni_off)
# ----------------------------------------------
nabijeni_off:
  alias: "GW - Vypnout nab√≠jen√≠"
  description: "Vypne nab√≠jen√≠ baterie z gridu (vol√° integrace automaticky)"
  icon: mdi:battery-off
  sequence:
    # Varianta A: Pokud m√°te GoodWe switch p≈ô√≠mo
    - service: switch.turn_off
      target:
        entity_id: switch.goodwe_battery_charge_from_grid
    
    # Varianta B: Pokud ovl√°d√°te p≈ôes ModBus
    # - service: modbus.write_register
    #   data:
    #     hub: goodwe
    #     address: 45352  # Grid charge enable register
    #     value: 0
    
    # Varianta C: Pokud pou≈æ√≠v√°te REST API
    # - service: rest_command.goodwe_disable_charging
    
    # Logov√°n√≠ pro diagnostiku
    - service: logbook.log
      data:
        name: "GW Smart Charging"
        message: "Nab√≠jen√≠ VYPNUTO - re≈æim: {{ states('sensor.gw_smart_charging_schedule') }}"
    
    # Volitelnƒõ: Notifikace
    # - service: notify.persistent_notification
    #   data:
    #     title: "üîã GW Nab√≠jen√≠"
    #     message: "Nab√≠jen√≠ baterie VYPNUTO"

# 3. Advanced: Script s podm√≠nkami (voliteln√©)
# --------------------------------------------
nabijeni_on_advanced:
  alias: "GW - Zapnout nab√≠jen√≠ (Advanced)"
  description: "Zapne nab√≠jen√≠ s dodateƒçn√Ωmi kontrolami"
  icon: mdi:battery-charging-wireless
  sequence:
    # Kontrola: Pouze pokud SOC pod 90%
    - condition: numeric_state
      entity_id: sensor.battery_state_of_charge
      below: 90
    
    # Kontrola: Pouze pokud cena pod limitem
    - condition: numeric_state
      entity_id: sensor.gw_smart_charging_price
      below: 4.0
    
    # Zapnut√≠ nab√≠jen√≠
    - service: switch.turn_on
      target:
        entity_id: switch.goodwe_battery_charge_from_grid
    
    # Nastaven√≠ nab√≠jec√≠ho proudu (pokud podporov√°no)
    # - service: number.set_value
    #   target:
    #     entity_id: number.goodwe_charge_current
    #   data:
    #     value: 30  # Amp√©ry
    
    # Logov√°n√≠ s detaily
    - service: logbook.log
      data:
        name: "GW Smart Charging Advanced"
        message: >
          Nab√≠jen√≠ ZAPNUTO
          SOC: {{ states('sensor.battery_state_of_charge') }}%
          Cena: {{ state_attr('sensor.gw_smart_charging_schedule', 'current_price') }} CZK/kWh
          Re≈æim: {{ states('sensor.gw_smart_charging_schedule') }}

# 4. Advanced: Script s nastaven√≠m priority (voliteln√©)
# -----------------------------------------------------
nabijeni_on_priority:
  alias: "GW - Zapnout nab√≠jen√≠ s prioritou"
  description: "Zapne nab√≠jen√≠ a nastav√≠ spr√°vnou prioritu"
  sequence:
    # Nastavit battery priority mode
    - service: select.select_option
      target:
        entity_id: select.goodwe_battery_mode
      data:
        option: "Battery First"  # Nebo "Grid First" podle pot≈ôeby
    
    # Zapnout nab√≠jen√≠
    - service: switch.turn_on
      target:
        entity_id: switch.goodwe_battery_charge_from_grid
    
    # ƒåekat na potvrzen√≠
    - delay:
        seconds: 5
    
    # Kontrola zda se skuteƒçnƒõ zapnulo
    - condition: state
      entity_id: switch.goodwe_battery_charge_from_grid
      state: "on"
    
    # Logov√°n√≠
    - service: system_log.write
      data:
        level: info
        message: "GW Smart Charging: Nab√≠jen√≠ √∫spƒõ≈°nƒõ zapnuto s Battery First re≈æimem"

# 5. Testovac√≠ script (pro diagnostiku)
# --------------------------------------
test_gw_charging:
  alias: "GW - Test nab√≠jen√≠"
  description: "Testovac√≠ script pro ovƒõ≈ôen√≠ funkƒçnosti"
  sequence:
    # Test ON
    - service: script.turn_on
      target:
        entity_id: script.nabijeni_on
    
    - service: persistent_notification.create
      data:
        title: "Test GW Charging"
        message: "Nab√≠jen√≠ zapnuto - ƒçek√°m 30s"
    
    - delay:
        seconds: 30
    
    # Test OFF
    - service: script.turn_on
      target:
        entity_id: script.nabijeni_off
    
    - service: persistent_notification.create
      data:
        title: "Test GW Charging"
        message: "Nab√≠jen√≠ vypnuto - test dokonƒçen"

# 6. Emergency stop script
# ------------------------
gw_emergency_stop:
  alias: "GW - Nouzov√© zastaven√≠"
  description: "Okam≈æitƒõ zastav√≠ nab√≠jen√≠"
  icon: mdi:alert-octagon
  sequence:
    - service: script.turn_on
      target:
        entity_id: script.nabijeni_off
    
    - service: notify.mobile_app
      data:
        title: "üö® GW Emergency Stop"
        message: "Nouzov√© zastaven√≠ nab√≠jen√≠ aktivov√°no!"
    
    - service: system_log.write
      data:
        level: warning
        message: "GW Smart Charging: Emergency stop triggered!"
